<script setup>
    import { reactive, ref } from 'vue'
    import CandleChart from '@/components/charts/CandleChart.vue';

    const coinList = reactive([{coinNm: 'XLM'}, {coinNm: 'XRP'}, {coinNm: 'BTC'}])
    const coinTitle = ref('Coin List')
        
    // 날짜, open, close, low, high, volume
    let rawData = ref([ ]);
    const dates = ref();

    function getDates(e) {
        // event 확인하기 위함.
        // console.log(dates)
        console.log(e)
    }

    function selectCoin(coinNm) {
        console.log(coinNm)
        coinTitle.value = coinNm

        let newData = []
        if(coinNm === 'XLM') {
            newData = [
                ["2025-11-01", 100.5, 102.3, 99.8, 103.0, 500000],
                ["2025-11-02", 102.3, 101.5, 100.2, 103.5, 450000],
                ["2025-11-03", 101.5, 104.0, 101.0, 104.2, 480000],
                ["2025-11-04", 104.0, 103.8, 102.5, 105.0, 520000],
                ["2025-11-05", 103.8, 105.5, 103.5, 106.0, 600000],
                ["2025-11-06", 105.5, 106.2, 104.8, 106.5, 580000],
                ["2025-11-07", 106.2, 107.0, 105.5, 107.5, 610000],
                ["2025-11-08", 107.0, 106.8, 105.8, 107.8, 590000],
                ["2025-11-09", 106.8, 108.2, 106.5, 108.5, 620000],
                ["2025-11-10", 108.2, 109.0, 107.5, 109.5, 640000]
            ];
        } else if (coinNm === 'XRP') {
            newData = [
                ["2015-01-02", 17823.07, 17832.99, 17731.92, 17923.23, 347300000],
                ["2015-01-05", 17832.99, 17731.92, 17600.01, 17923.23, 347300000],
                ["2015-01-06", 17729.21, 17371.64, 17262.75, 17729.21, 476600000],
                ["2015-01-07", 17378.08, 17584.52, 17378.08, 17630.11, 363800000],
                ["2015-01-08", 17589.73, 17907.87, 17589.73, 17908.17, 377700000],
                ["2015-01-09", 17909.07, 17737.37, 17697.62, 17917.66, 389500000],
                ["2015-01-12", 17735.05, 17640.84, 17573.51, 17812.09, 342400000],
                ["2015-01-13", 17641.72, 17613.68, 17573.51, 17782.13, 396300000],
                ["2015-01-14", 17610.22, 17427.09, 17375.48, 17610.22, 410700000],
                ["2015-01-15", 17431.85, 17320.71, 17290.15, 17500.51, 391000000],
                ["2015-01-16", 17323.82, 17511.57, 17323.82, 17524.95, 377200000],
                ["2015-01-20", 17510.92, 17515.23, 17472.48, 17612.18, 362000000],
                ["2015-01-21", 17515.23, 17554.28, 17472.48, 17612.18, 342000000],
                ["2015-01-22", 17550.23, 17813.98, 17550.23, 17820.15, 356000000],
                ["2015-01-23", 17813.98, 17672.60, 17650.20, 17835.00, 348000000],
                ["2015-01-26", 17673.12, 17678.70, 17550.00, 17780.22, 314000000],
                ["2015-01-27", 17678.70, 17387.21, 17350.00, 17700.00, 382000000],
                ["2015-01-28", 17387.21, 17191.37, 17100.00, 17450.00, 421000000],
                ["2015-01-29", 17191.37, 17416.85, 17191.37, 17450.00, 403000000],
                ["2015-01-30", 17416.85, 17164.95, 17100.00, 17420.00, 423000000],
                ["2015-02-02", 17164.95, 17361.04, 17100.00, 17400.00, 382000000],
                ["2015-02-03", 17361.04, 17666.40, 17361.04, 17700.00, 369000000],
                ["2015-02-04", 17666.40, 17673.02, 17600.00, 17750.00, 343000000],
                ["2015-02-05", 17673.02, 17884.88, 17650.00, 17900.00, 356000000],
                ["2015-02-06", 17884.88, 17824.29, 17780.00, 17950.00, 317000000],
                ["2015-02-09", 17824.29, 17729.21, 17700.00, 17880.00, 293000000],
                ["2015-02-10", 17729.21, 17868.76, 17729.21, 17900.00, 276000000],
                ["2015-02-11", 17868.76, 17862.14, 17800.00, 17900.00, 273000000],
                ["2015-02-12", 17862.14, 17972.38, 17850.00, 18000.00, 280000000],
                ["2015-02-13", 17972.38, 18019.35, 17950.00, 18050.00, 274000000],
                ["2015-02-17", 18019.35, 18047.58, 18000.00, 18070.00, 270000000],
                ["2015-02-18", 18047.58, 18029.85, 18000.00, 18080.00, 260000000],
                ["2015-02-19", 18029.85, 17985.77, 17950.00, 18070.00, 280000000],
                ["2015-02-20", 17985.77, 18140.44, 17985.77, 18150.00, 292000000],
                ["2015-02-23", 18140.44, 18116.84, 18100.00, 18180.00, 280000000],
                ["2015-02-24", 18116.84, 18209.19, 18100.00, 18220.00, 290000000],
                ["2015-02-25", 18209.19, 18224.57, 18180.00, 18250.00, 310000000],
                ["2015-02-26", 18224.57, 18214.42, 18200.00, 18250.00, 280000000],
                ["2015-02-27", 18214.42, 18132.70, 18100.00, 18250.00, 290000000],
                ["2015-03-02", 18132.70, 18288.63, 18132.70, 18300.00, 315000000],
                ["2015-03-03", 18288.63, 18203.37, 18200.00, 18300.00, 296000000],
                ["2015-03-04", 18203.37, 18096.90, 18000.00, 18250.00, 310000000],
                ["2015-03-05", 18096.90, 18135.72, 18000.00, 18200.00, 290000000],
                ["2015-03-06", 18135.72, 17856.78, 17800.00, 18150.00, 340000000],
                ["2015-03-09", 17856.78, 17995.72, 17850.00, 18000.00, 305000000],
                ["2015-03-10", 17995.72, 17662.94, 17650.00, 18000.00, 342000000],
                ["2015-03-11", 17662.94, 17635.39, 17600.00, 17750.00, 302000000],
                ["2015-03-12", 17635.39, 17895.22, 17635.39, 17900.00, 292000000],
                ["2015-03-13", 17895.22, 17749.31, 17700.00, 17900.00, 325000000],
                ["2015-03-16", 17749.31, 17977.42, 17749.31, 18000.00, 288000000],
                ["2015-03-17", 17977.42, 17949.31, 17900.00, 18000.00, 276000000],
                ["2015-03-18", 17949.31, 18076.19, 17900.00, 18100.00, 325000000],
                ["2015-03-19", 18076.19, 17959.03, 17900.00, 18100.00, 295000000],
                ["2015-03-20", 17959.03, 18127.65, 17959.03, 18150.00, 410000000]
            ];
        }

        // reactive 배열의 내부만 교체 (reactivity 유지)
        rawData.value = newData
    }

</script>

<template>
    <div id="common_body">
        <div class="text">
            <div class="view_title">Candle Chart</div>


            <div class="select-section">
                <div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        {{ coinTitle }}
                    </button>
                    <ul class="dropdown-menu">
                        <li :key="coin.id" v-for="coin in coinList">
                            <a class="dropdown-item" @click="selectCoin(coin.coinNm)"> {{ coin.coinNm }} </a>
                        </li>
                    </ul>
                </div>

                <!-- datapicker 내부적으로 model-value 라는 값으로 emit하나봄-->
                <VueDatePicker 
                    v-model="dates" 
                    @update:model-value="getDates"
                    range 
                    class="date-picker"
                />
            </div>
            
            <div class="chart-view">

                <CandleChart
                    :raw-data="rawData"
                    :coin-title="coinTitle"
                />
            </div>
            
        </div>
    </div>
</template>


<style scoped>
    .text {
        padding: 12px 60px;
    }

    .view_title {
        font-size: 25px;
        padding-bottom: 25px;
    }

    .dropdown {
        display: flex;
        align-items: center; 
    }

    .select-section {
        display: flex;
        gap: 20px; 
        align-items: center; 
        padding: 12px 16px;
        background-color: #f5f6fa;  /* 부드러운 배경 */
        border-radius: 12px;         /* 둥글게 */
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        margin-bottom: 20px;         /* 아래 콘텐츠와 간격 */
    }

    .btn.btn-secondary.dropdown-toggle {
        height: 38px;
        display: flex;
        align-items: center;
        border-radius: 1rem;
    }
    
    .date-picker {
        max-width: 350px; 
        font-size: 12px;
    }

    /* DatePicker input wrapper + input 둥글게 */
    .date-picker .dp__input_wrap,
    .date-picker .dp__input {
        border-radius: 1rem;
        border: 1px solid #ced4da;
        padding: 0 12px;
        height: 38px;
        box-sizing: border-box;
    }

    .btn.btn-secondary.dropdown-toggle {
        color: #fff;  
    }
    

    .dropdown-menu {
        opacity: 0;
        /* transform: translateY(10px); */
        visibility: hidden;
        transition: opacity 0.25s ease, transform 0.25s ease, visibility 0.25s;
    }

    /* dropdown이 열릴 때 (Bootstrap에서 자동으로 .show 클래스 추가됨) */
    .dropdown-menu.show {
        opacity: 1;
        /* transform: translateY(0); */
        visibility: visible;

    }

    .chart-view {
        background-color: #f8f9fc;  /* 살짝 다른 부드러운 배경 */
        padding: 24px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        margin-top: 20px;
    }
</style>
